
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iPhone 17ã‚·ãƒªãƒ¼ã‚º è©³ç´°ï¼ˆãƒ¢ãƒã‚¹ãƒ†è‡ªå‹•å–å¾—å¯¾å¿œï¼‰</title>
  <link rel="stylesheet" href="./assets/styles.css">
  <script src="./assets/data.js"></script>
  <script src="./assets/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="hdr">
      <div class="logo">ğŸ“ˆ è©³ç´°ãƒ“ãƒ¥ãƒ¼</div>
      <div class="small">æœ€çµ‚æ›´æ–°: <span id="updated"></span></div>
    </div>

    <div class="card">
      <h1 id="title"></h1>
      <div class="filters" id="store-filters"></div>
      <div class="small" style="margin-top:6px">â€» ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸåº—èˆ—ã¯ä¸€è¦§ã¨åŒæ§˜ã«é™¤å¤–ã•ã‚Œã¾ã™ã€‚</div>
      <div style="margin-top:10px">
        <label>è‰²ã®é¸æŠ: <select id="colorSel"></select></label>
      </div>
    </div>

    <div class="card">
      <h2>å„åº—ã®ç¾åœ¨ä¾¡æ ¼ï¼ˆé«˜ã„é †ï¼‰</h2>
      <table class="table" id="price-table">
        <thead><tr><th>#</th><th>åº—èˆ—</th><th>ä¾¡æ ¼</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <footer class="small">Â© 2025 iPhone 17 è²·å–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</footer>
  </div>

  <script>
    const params=new URLSearchParams(location.search);const sku=params.get('sku')||'iphone17-256';
    const v=window.PRICE_DATA.variants.find(x=>x.sku===sku);document.getElementById('updated').textContent=(window.PRICE_DATA.last_built_at||'').replace('T',' ').replace('+09:00',' (JST)');
    const msrp=window.PRICE_DATA.msrp[sku];
    function fillColors(){const sel=document.getElementById('colorSel');const colors=Object.keys(v.colors||{"å…¨è‰²":{}});colors.forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o)});const q=params.get('color');if(q&&colors.includes(q))sel.value=q;sel.addEventListener('change',renderTable)}
    function renderTitle(){const color=document.getElementById('colorSel').value||'å…¨è‰²';document.getElementById('title').textContent=`${v.title} / ${color} / å®šä¾¡ ${formatJPY(msrp)}`}
    function renderTable(){renderTitle();const {selected}=window.SITE.getStoreFilters();const color=document.getElementById('colorSel').value||'å…¨è‰²';const per=[];for(const st of selected){let price=(v.colors?.[color]||{})[st];if(price==null){const p=(v.prices||[]).find(x=>x.store===st&&x.price_jpy!=null);price=p?p.price_jpy:null}if(price!=null){const link=(v.prices||[]).find(x=>x.store===st)?.link||'#';per.push({store:st,price_jpy:price,link})}}per.sort((a,b)=>b.price_jpy-a.price_jpy);const tb=document.querySelector('#price-table tbody');tb.innerHTML='';per.forEach((r,i)=>{const tr=document.createElement('tr');tr.innerHTML=`<td class="rank">${i+1}</td><td><a href="${r.link}" target="_blank" rel="noopener">${r.store}</a></td><td>${formatJPY(r.price_jpy)}</td>`;tb.appendChild(tr)})}
    function init(){window.SITE.renderStoreFilters(document.getElementById('store-filters'));window.onFiltersApplied=renderTable;fillColors();renderTable()}
    init();
  </script>
</body>
</html>
